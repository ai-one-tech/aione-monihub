# 快速入门

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [apps/frontend/README.md](file://apps/frontend/README.md)
- [apps/frontend/package.json](file://apps/frontend/package.json)
- [apps/server/README.md](file://apps/server/README.md)
- [apps/server/Cargo.toml](file://apps/server/Cargo.toml)
- [apps/agent/js/package.json](file://apps/agent/js/package.json)
- [apps/agent/java/pom.xml](file://apps/agent/java/pom.xml)
- [docker/README.md](file://docker/README.md)
- [apps/frontend/vite.config.ts](file://apps/frontend/vite.config.ts)
- [apps/server/src/main.rs](file://apps/server/src/main.rs)
</cite>

## 目录
1. [简介](#简介)
2. [环境准备](#环境准备)
3. [项目克隆与初始化](#项目克隆与初始化)
4. [前端本地启动](#前端本地启动)
5. [后端本地启动](#后端本地启动)
6. [代理端本地启动](#代理端本地启动)
7. [环境变量配置](#环境变量配置)
8. [服务验证](#服务验证)
9. [Docker快速部署](#docker快速部署)
10. [常见问题与解决方案](#常见问题与解决方案)

## 简介
本指南旨在帮助新手开发者快速搭建 `aione-monihub` 项目的本地开发环境。项目包含前端（基于 Vite + React）、后端（基于 Rust + Axum）和代理端（支持 Java/Maven 或 Node.js）。通过本指南，您将学会如何克隆仓库、安装依赖、配置环境变量并启动各模块服务。

## 环境准备
在开始之前，请确保您的开发机器已安装以下基础工具：

- **Git**：用于克隆代码仓库
- **Node.js (v18+)**：用于前端和 Node.js 代理端
- **Rust (via rustup)**：用于后端编译运行
- **Java JDK 11+ 与 Maven**：用于 Java 代理端（可选）
- **Docker**：用于容器化部署（可选）

推荐使用版本管理工具：
- 使用 `nvm` 管理 Node.js 版本
- 使用 `rustup` 管理 Rust 工具链

## 项目克隆与初始化
### 1. 克隆仓库
```bash
git clone https://github.com/ai-one-tech/aione-monihub.git
cd aione-monihub
```

### 2. 安装根目录依赖（可选）
如果根目录有 `package.json`，可先运行：
```bash
npm install
```

### 3. 初始化子模块（如有）
本项目暂无 Git 子模块，跳过此步。

**Section sources**
- [README.md](file://README.md)

## 前端本地启动
前端位于 `apps/frontend`，基于 Vite 构建。

### 1. 进入前端目录并安装依赖
```bash
cd apps/frontend
npm install
```

### 2. 启动开发服务器
```bash
npm run dev
```

### 3. 预期输出
```
vite v5.0.0 dev server running at:
> Local: http://localhost:5173/
> Network: use `--host` to expose
```

前端默认监听 `5173` 端口，可通过 `vite.config.ts` 修改。

**Section sources**
- [apps/frontend/README.md](file://apps/frontend/README.md)
- [apps/frontend/package.json](file://apps/frontend/package.json)
- [apps/frontend/vite.config.ts](file://apps/frontend/vite.config.ts)

## 后端本地启动
后端位于 `apps/server`，基于 Rust 构建。

### 1. 进入后端目录
```bash
cd apps/server
```

### 2. 构建项目
```bash
cargo build
```

### 3. 运行后端服务
```bash
cargo run
```

### 4. 预期输出
```
Server running at http://127.0.0.1:8080
Database connected successfully
Migrations applied.
```

后端默认监听 `8080` 端口，可通过环境变量 `SERVER_PORT` 修改。

**Section sources**
- [apps/server/README.md](file://apps/server/README.md)
- [apps/server/Cargo.toml](file://apps/server/Cargo.toml)
- [apps/server/src/main.rs](file://apps/server/src/main.rs)

## 代理端本地启动
代理端位于 `apps/agent`，支持 Node.js 和 Java 两种实现。

### Node.js 版本启动
```bash
cd apps/agent/js
npm install
npm start
```

### Java 版本启动（Maven）
```bash
cd apps/agent/java
mvn compile
mvn exec:java
```

或打包后运行：
```bash
mvn package
java -jar target/agent-java-1.0.jar
```

代理端默认连接 `localhost:8080` 的后端服务，可通过配置文件调整。

**Section sources**
- [apps/agent/js/package.json](file://apps/agent/js/package.json)
- [apps/agent/java/pom.xml](file://apps/agent/java/pom.xml)

## 环境变量配置
项目依赖多个环境变量，需在各模块根目录创建 `.env` 文件。

### 前端环境变量示例（`apps/frontend/.env`）
```env
VITE_API_BASE_URL=http://localhost:8080/api
VITE_CLERK_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxxx
```

### 后端环境变量示例（`apps/server/.env`）
```env
DATABASE_URL=sqlite:./data/app.db
CLERK_SECRET_KEY=sk_test_xxxxxxxxxxxxxx
SERVER_PORT=8080
```

### 代理端环境变量示例（`apps/agent/js/.env`）
```env
AGENT_SERVER_URL=http://localhost:8080
AGENT_MODE=development
```

**关键配置说明**：
- `DATABASE_URL`：支持 SQLite、PostgreSQL
- `CLERK_SECRET_KEY`：从 Clerk 控制台获取
- `VITE_API_BASE_URL`：前端调用后端 API 的地址

**Section sources**
- [apps/frontend/.env.example](file://apps/frontend/.env.example)
- [apps/server/.env.example](file://apps/server/.env.example)
- [apps/agent/js/.env.example](file://apps/agent/js/.env.example)

## 服务验证
完成启动后，按以下步骤验证系统正常运行：

1. 打开浏览器访问：[http://localhost:5173](http://localhost:5173)
2. 检查前端是否加载成功，无控制台报错
3. 打开开发者工具，查看网络请求是否成功调用 `http://localhost:8080/api/health`
4. 验证返回 JSON：`{"status": "ok"}`
5. 尝试登录/注册流程，确保 Clerk 认证集成正常

若所有请求返回 200 状态码，则系统运行正常。

## Docker快速部署
项目提供 Docker 支持，详见 `docker/README.md`。

### 1. 构建并启动所有服务
```bash
cd docker
docker-compose up --build
```

### 2. 预期服务映射
- 前端：`http://localhost:5173`
- 后端：`http://localhost:8080`
- 数据库：`localhost:5432`（PostgreSQL）

### 3. 自定义配置
修改 `docker/.env` 文件可调整数据库密码、端口等。

容器化部署自动处理依赖安装与环境变量注入，适合快速体验完整系统。

**Section sources**
- [docker/README.md](file://docker/README.md)
- [docker/docker-compose.yml](file://docker/docker-compose.yml)

## 常见问题与解决方案
### 1. 端口冲突
**问题**：`Error: listen EADDRINUSE: address already in use`
**解决**：
- 更改前端端口：在 `vite.config.ts` 中设置 `server.port = 5174`
- 更改后端端口：设置环境变量 `SERVER_PORT=8081`

### 2. 依赖安装失败
**Node.js**：
```bash
# 清除缓存重试
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

**Rust**：
```bash
# 更新工具链
rustup update
cargo clean
cargo build
```

### 3. 数据库连接失败
**检查**：
- 确保 `DATABASE_URL` 路径目录存在
- SQLite 需手动创建 `data/` 目录
- PostgreSQL 需启动数据库服务

### 4. Clerk 认证密钥缺失
**解决**：
- 访问 [Clerk Dashboard](https://dashboard.clerk.com)
- 创建新应用，复制 `Secret Key` 和 `Publishable Key`
- 填入 `.env` 文件对应字段

### 5. Docker 构建失败
**解决**：
- 确保 Docker 有足够的内存（建议 4GB+）
- 清理构建缓存：`docker builder prune`
- 重新运行：`docker-compose up --build --force-recreate`

**Section sources**
- [apps/frontend/README.md](file://apps/frontend/README.md)
- [apps/server/README.md](file://apps/server/README.md)
- [docker/README.md](file://docker/README.md)