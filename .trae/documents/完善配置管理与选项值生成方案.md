## 目标
- 基于你提供的配置类型集合，仅支持：`object`、`array`、`html`、`text`。
- 在 `configs` 表新增：`generate_values`（仅 `array` 生效）与 `schema`（用于 `object/array` 校验）。
- 引入 `config_values` 表，支持软删除（`deleted_at`）与乐观锁（`revision`），用于把 `array` 类型的选项项（包含 `code`、`name`）结构化持久化，便于 JOIN 查询。

## 数据库变更
1. `configs` 表：
   - `generate_values boolean NOT NULL DEFAULT false`（仅当 `config_type = 'array'` 显示与生效）。
   - `schema jsonb NULL`（仅 `object/array` 需要）。
   - 更新列注释：`config_type` 仅允许 `object, array, html, text`。
2. 新增 `config_values` 表：
   - 字段：
     - `id varchar(64) PRIMARY KEY`
     - `config_id varchar(64) NOT NULL`（FK -> `configs.id` ON DELETE CASCADE）
     - `config_code varchar(100) NOT NULL`
     - `environment varchar(50) NOT NULL`
     - `version int4 NOT NULL`
     - `value_code varchar(100) NOT NULL`
     - `value_name varchar(255) NOT NULL`
     - `value_data jsonb NULL`
     - `revision int4 NOT NULL DEFAULT 1`（乐观锁，每次更新 +1）
     - `deleted_at timestamptz(3) NULL`（软删除，默认 NULL）
     - `created_at timestamptz(3) NOT NULL DEFAULT now()`
     - `updated_at timestamptz(3) NOT NULL DEFAULT now()`
   - 约束/索引：
     - 部分唯一索引（仅对未删除的数据生效）：
       - `CREATE UNIQUE INDEX uniq_cfg_values_active ON config_values(config_code, environment, version, value_code) WHERE deleted_at IS NULL;`
     - 索引：`idx_cfg_values_cfg_id`、`idx_cfg_values_cfg_code_env_ver`、`idx_cfg_values_value_code`、`idx_cfg_values_deleted_at`。
   - 触发器：`update_config_values_updated_at`（复用 `public.update_updated_at_column()`）。
3. 迁移文件：`apps/server/migrations/015_configs_generate_values_and_config_values.sql`（含 up/down）。

## 枚举与模型
- `apps/server/src/shared/enums.rs`：将 `ConfigType` 精简为仅包含 `Object`、`Array`、`Html`、`Text`。
- `apps/server/src/configs/models.rs`：
  - `ConfigCreateRequest` / `ConfigUpdateRequest` 增加：`generate_values: Option<bool>`、`schema: Option<String>`。
  - `ConfigResponse` 增加同字段（如需也可返回 `schema`）。
  - 可选新增 `ConfigValueResponse`（若提供查询值接口）。
- 实体：
  - `apps/server/src/entities/configs.rs`：新增 `generate_values: bool`、`schema: Option<Json>`。
  - 新增 `apps/server/src/entities/config_values.rs`：包含上述列，并在业务使用层面实现“部分唯一索引 + 软删除 + 修订号”的策略。

## 业务与校验
1. 创建（`apps/server/src/configs/handlers.rs:115`）：
   - `config_type` 仅允许：`object|array|html|text`；其他类型直接返回校验错误。
   - 校验：
     - `object`：`content` 必须为合法 JSON 对象；若 `schema` 提供，用 JSON Schema 校验。
     - `array`：`content` 必须为合法 JSON 数组；若 `schema` 提供，用 JSON Schema 校验。若 `generate_values == true`，数组元素必须为对象，且每项至少有 `code`（非空、唯一）与 `name`（非空）。
     - `html/text`：内容作为字符串存储，无结构校验。
   - 选项值生成（仅 `array + generate_values`）：
     - 新增项：插入记录（`deleted_at` 置 NULL，`revision = 1`）。
     - 更新项：更新 `value_name/value_data` 并 `revision = revision + 1`（需通过 WHERE 条件校验现有 `revision`，或在应用层每次更新读取当前值后递增）。
     - 删除项：软删除（`deleted_at = now()`）。
     - 恢复项：若历史有软删的 `value_code` 再次出现，执行反软删（`deleted_at = NULL`）并 `revision = revision + 1`。
2. 更新：新增 `update_config`（PUT `/api/configs/{id}`）：
   - 版本策略：新增一条新版本（`code+environment` 下 `version+1`），保持历史不可变。
   - 同步 `config_values`：针对新版本执行上述增量同步；旧版本数据不变。
   - 乐观锁在 `config_values` 层面用于保证并发更新的安全性（读-改-写时必须带上当前 `revision`）。
3. 查询：默认过滤 `deleted_at IS NULL`；如需审计/历史查看，可提供包含软删数据的管理查询。

## 路由与接口
- `apps/server/src/configs/routes.rs`：新增 `PUT /api/configs/{id}`。
- 可选：`GET /api/configs/{code}/values?environment=...&version=...`（仅返回未软删数据）。

## OpenAPI
- 为 `create/update` 请求体与响应补充 `generate_values`、`schema` 字段说明与示例。

## 验证
- 使用 `cargo build` / `cargo check` 验证编译。
- 构造 `array + generate_values` 示例，验证新增、更新（含 `revision` 递增）、软删与恢复。

## 改动文件
- 迁移：`apps/server/migrations/015_configs_generate_values_and_config_values.sql`
- 实体：`apps/server/src/entities/configs.rs`、`apps/server/src/entities/config_values.rs`
- 枚举/模型：`apps/server/src/shared/enums.rs`、`apps/server/src/configs/models.rs`
- 业务/路由：`apps/server/src/configs/handlers.rs`、`apps/server/src/configs/routes.rs`、`apps/server/src/configs/mod.rs` 或 `value_sync.rs`

请确认上述方案；确认后我将按此计划实施。