## 目标

* 在前端新增 `/logs/system` 页面，展示后端系统日志，并支持按日志级别、关键字、日期范围筛选与分页；保留导出能力。

* 后端复用现有 `logs` 表，完善查询接口过滤能力（级别、关键字、日期范围），与前端对齐参数与返回结构。

## 现状确认

* 前端：React + Vite（端口 5173），TanStack Router/Query，统一 `apiClient`，`/api` 通过 Vite 代理到后端；暂无 `/logs/system` 路由与页面。

* 后端：Rust + actix-web + sea-orm；已存在 `logs` 表与日志模块（`/api/v1/logs` 与 `/api/v1/logs/export`）。迁移文件已建表，无需新增表，需增强查询过滤。

## 前端实现

1. 新增路由文件：`apps/frontend/src/routes/_authenticated/logs/system.tsx`

   * 定义 `validateSearch`：`page`、`pageSize`、`level`、`keyword`、`startDate`、`endDate`

   * `component` 指向日志页面容器组件。
2. 新增页面容器：`apps/frontend/src/features/system/logs/index.tsx`

   * 读取路由 `search` 并映射为接口查询参数；使用 TanStack Query 拉取数据。

   * 使用现有 `components/data-table/*` 组合表格与工具栏。
3. 新增接口封装：`apps/frontend/src/features/system/logs/api/logs-api.ts`

   * `GET /api/v1/logs`：参数 `page`、`limit`、`log_level`、`keyword`、`start_date`、`end_date`。

   * 可选导出：`GET /api/v1/logs/export` 同参，触发下载。
4. 新增类型与查询 Hook：

   * `data/api-schema.ts`：`GetLogsParams`、`LogItem`、`LogListResponse`。

   * `hooks/use-logs-query.ts`：`queryKey: ['system-logs', params]`，返回 `data/items/total`。
5. 交互与展示

   * 列：`timestamp`（时间）/`log_level`（级别）/`log_source`（来源）/`message`（消息）/`application_id`。

   * 工具栏：级别下拉、关键字输入框、日期范围选择；分页控件；导出按钮（可选）。

   * 遵循 shadcn 风格组件与项目现有 UI 约定；所有请求使用 `apiClient`。

## 后端实现

1. 复用表：`apps/server/migrations/001_initial_schema.sql` 已包含 `logs` 表；不新增迁移。
2. 模型调整：`apps/server/src/logs/models.rs`

   * 在列表查询模型增加 `keyword: Option<String>`；参数名与前端一致。
3. 查询处理器：`apps/server/src/logs/handlers.rs`

   * `get_logs` 移除固定级别过滤；根据传参拼接条件：

     * `log_level` 精确匹配；

     * `keyword` 对 `message` 模糊匹配；

     * `start_date/end_date` 作用于 `timestamp` 范围；

     * 排序按 `timestamp` 倒序；

     * 分页返回 `items/total/page/limit`。
4. 路由维持不变：`apps/server/src/logs/routes.rs` 已注册 `/api/v1/logs` 与 `/api/v1/logs/export`。

## 接口契约

* 请求：`GET /api/v1/logs?page&limit&log_level&keyword&start_date&end_date`

* 响应：`{ items: LogItem[], total: number, page: number, limit: number }`

* `LogItem` 字段：`id`、`application_id`、`log_level`、`message`、`context`（JSON，可选）、`log_source`、`timestamp`、`created_at`。

## 验证

* 后端：按项目规则使用 `cargo check` / `cargo build` 检查；确认查询过滤正确与编译通过。

* 前端：通过菜单或直接访问 `/logs/system` 验证筛选与分页；所有请求经 `/api` 代理；不可使用 `npm run dev`（已有运行环境）。

## 交付

* 前端：路由与页面、接口封装、查询 Hook、表格与筛选组件就绪；与菜单项 `/logs/system` 对齐。

* 后端：完善过滤逻辑与参数模型；无新增表或迁移；保持导出接口可用。

